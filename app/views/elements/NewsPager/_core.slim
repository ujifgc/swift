ruby:
  @swift[:module_path_ids] = []
  filter = {}
  filter[:news_rubric_id] = @rubric.id  if @rubric
  if params[:year]
    filter[:date] = Date.new(params[:year].to_i)..Date.new(params[:year].to_i,12,-1)
  end
  if params[:month]
    date_a = Date.new(params[:year].to_i,params[:month].to_i,1)
    filter[:date] = date_a..(date_a>>1)
  end
  @articles_count = NewsArticle.published.count(filter)

  @per_page = @opts[:per_page] || 10

  @pages_count = (@articles_count - 1) / @per_page + 1
  @page = params[:page] ? params[:page].to_i : 1
  filter.merge! :limit => @per_page, :offset => (@page - 1) * @per_page, :order => [ :date.desc ]

  @articles = NewsArticle.published.all(filter)
